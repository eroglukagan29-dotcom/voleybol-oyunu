<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Duck Hunt: Modern Arcade</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --neon-green: #39ff14;
            --arcade-red: #ff003c;
            --ui-bg: rgba(0, 0, 0, 0.7);
        }
        body { margin: 0; background: #050505; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        
        /* MODERN HUD */
        #hud {
            position: fixed; top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between;
            z-index: 10; pointer-events: none;
            display: none;
        }
        .stat-box {
            background: var(--ui-bg);
            padding: 15px 25px;
            border-left: 5px solid var(--neon-green);
            border-radius: 5px;
            font-size: 20px;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.2);
        }
        #ammo-bar { color: var(--arcade-red); font-size: 30px; }

        /* BAƒûLANTI PANELƒ∞ */
        #setup-ui {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #111; padding: 40px; border-radius: 20px;
            border: 2px solid var(--neon-green); text-align: center;
        }
        
        canvas { display: none; background: linear-gradient(to bottom, #4ec0ff 0%, #a6e3ff 100%); }
        
        #fireBtn {
            display: none; position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 180px; height: 180px; border-radius: 50%;
            background: radial-gradient(circle, #ff003c, #990024);
            border: 10px solid #eee; color: white; font-size: 28px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
        }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat-box">SCORE: <span id="score">0000</span></div>
    <div id="ammo-bar">‚óè ‚óè ‚óè</div>
    <div class="stat-box" id="p2-status">P2: BEKLENƒ∞YOR...</div>
</div>

<div id="setup-ui">
    <h1 style="color: var(--neon-green)">DUCK HUNT PRO</h1>
    <button onclick="start('screen')" style="padding:15px; cursor:pointer">üì∫ EKRANI BA≈ûLAT</button>
    <button onclick="start('gun')" style="padding:15px; cursor:pointer">üî´ Sƒ∞LAHI BA≈ûLAT</button>
    <div id="conn-info" style="margin-top:20px"></div>
</div>

<canvas id="game"></canvas>
<button id="fireBtn">FIRE</button>

<script>
let peer, conn, role;
let score = 0;
let ammo = 3;
let gamepadConnected = false;

// ASSET Y√úKLEME (Burasƒ± ileride resim eklemek i√ßin hazƒ±r)
const assets = {
    duck: new Image(),
    bg: new Image()
};
// assets.duck.src = 'duck_sprite.png'; // Buraya kendi linkini koyabilirsin

function start(r) {
    role = r;
    document.getElementById('setup-ui').style.display = 'none';
    peer = new Peer('DH-' + Math.floor(1000 + Math.random() * 9000));
    
    peer.on('open', (id) => {
        document.getElementById('setup-ui').style.display = 'block';
        document.getElementById('conn-info').innerHTML = `KOD: <b style="font-size:30px; color:var(--neon-green)">${id.replace('DH-','')}</b>`;
        if(role === 'gun') {
            let target = prompt("Ekrandaki kodu girin:");
            if(target) {
                conn = peer.connect('DH-' + target.toUpperCase());
                setupConn();
            }
        }
    });
    peer.on('connection', (c) => { conn = c; setupConn(); });
}

function setupConn() {
    conn.on('open', () => {
        document.getElementById('setup-ui').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        if(role === 'screen') initGame();
        else document.getElementById('fireBtn').style.display = 'block';
    });
    conn.on('data', data => {
        if(data === 'SHOT') window.shoot();
    });
}

// GAMEPAD KONTROL√ú
window.addEventListener("gamepadconnected", () => { 
    gamepadConnected = true; 
    document.getElementById('p2-status').innerText = "P2: GAMEPAD BAƒûLI";
});

function initGame() {
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    cvs.style.display = 'block';
    cvs.width = window.innerWidth; cvs.height = window.innerHeight;

    let duck = { x: 300, y: 300, r: 40, hit: false, speed: 5 };
    let flash = false;

    window.shoot = () => {
        flash = true;
        // Basit mesafe kontrol√º (Silahƒ±n vurduƒüunu varsayƒ±yoruz)
        // Eƒüer telefon kamerasƒ±nƒ± kullanmƒ±yorsak buraya tƒ±klanan yer kontrol√º gelebilir
        setTimeout(() => {
            flash = false;
            if(Math.random() > 0.5) { // ≈ûimdilik %50 ≈üansla vurulma
                duck.hit = true;
                score += 100;
                document.getElementById('score').innerText = score.toString().padStart(4, '0');
                setTimeout(() => { duck.hit = false; duck.y = cvs.height; }, 1000);
            }
        }, 80);
    };

    function update() {
        // Gamepad ile √ñrdek Kontrol√º
        if (gamepadConnected) {
            const gp = navigator.getGamepads()[0];
            if (gp) {
                duck.x += gp.axes[0] * 10; // Sol Analog Yatay
                duck.y += gp.axes[1] * 10; // Sol Analog Dikey
            }
        } else if (!duck.hit) {
            // Otomatik Hareket (Eƒüer gamepad yoksa)
            duck.x += duck.speed;
            if(duck.x > cvs.width || duck.x < 0) duck.speed *= -1;
        }

        if(duck.hit) duck.y += 10;
    }

    function draw() {
        ctx.fillStyle = flash ? "white" : "#4ec0ff";
        ctx.fillRect(0,0,cvs.width, cvs.height);

        if(!flash) {
            ctx.fillStyle = duck.hit ? "red" : "yellow";
            ctx.beginPath(); ctx.arc(duck.x, duck.y, duck.r, 0, Math.PI*2); ctx.fill();
            
            // Kanat √ßƒ±rpma sim√ºlasyonu
            ctx.fillStyle = "black";
            ctx.fillRect(duck.x - 45, duck.y - 5, 20, 10);
            ctx.fillRect(duck.x + 25, duck.y - 5, 20, 10);
        }
        update();
        requestAnimationFrame(draw);
    }
    draw();
}

// Sƒ∞LAH TETƒ∞ƒûƒ∞
document.getElementById('fireBtn').onclick = () => {
    if(conn && conn.open) conn.send('SHOT');
};
</script>
</body>
</html>

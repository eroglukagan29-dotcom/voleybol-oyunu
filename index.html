
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Duck Hunt: Pro Hunter</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { margin: 0; background: #1a1a1a; color: #fff; font-family: 'Courier New', Courier, monospace; text-align: center; overflow: hidden; }
        .box { background: #222; padding: 20px; border-radius: 15px; display: inline-block; margin-top: 50px; border: 3px solid #ffcc00; }
        button { background: #ffcc00; color: #000; border: none; padding: 15px 25px; font-weight: bold; border-radius: 10px; cursor: pointer; margin: 10px; }
        canvas { display: none; background: #4ec0ff; width: 100vw; height: 100vh; }
        #fireBtn { display: none; position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); width: 160px; height: 160px; border-radius: 50%; background: #cc0000; border: 8px solid #fff; color: white; font-size: 24px; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        #fireBtn:active { transform: translateX(-50%) scale(0.95); background: #ff0000; }
        #score-board { position: fixed; top: 10px; left: 10px; font-size: 24px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; color: #39ff14; display: none; }
        #video-hidden { display: none; }
    </style>
</head>
<body>

<div id="ui" class="box">
    <h2 style="color:#ffcc00">DUCK HUNT PRO</h2>
    <div id="role-select">
        <button onclick="start('screen')">ðŸ“º EKRAN (PC)</button>
        <button onclick="start('gun')">ðŸ”« SÄ°LAH (TELEFON)</button>
    </div>
    <div id="display-area" style="display:none">
        <h1 id="id-show" style="letter-spacing: 5px; color: #39ff14;">----</h1>
        <div id="qrcode" style="background: white; padding: 5px; display: inline-block;"></div>
        <div id="gun-input" style="display:none">
            <input type="text" id="target-id" placeholder="KOD" style="font-size:20px; width:100px; padding:10px; text-align:center">
            <button onclick="connect()">BAÄžLAN</button>
        </div>
        <p id="status">HazÄ±rlanÄ±yor...</p>
    </div>
</div>

<div id="score-board">SCORE: 0</div>
<canvas id="game"></canvas>
<video id="video-hidden" autoplay playsinline></video>
<button id="fireBtn">ATEÅž!</button>

<script>
let peer, conn, role;
let score = 0;
const status = document.getElementById('status');
const video = document.getElementById('video-hidden');

function start(r) {
    role = r;
    document.getElementById('role-select').style.display = 'none';
    document.getElementById('display-area').style.display = 'block';
    
    peer = new Peer('DH-' + Math.floor(1000 + Math.random() * 9000));

    peer.on('open', (id) => {
        const shortId = id.replace('DH-', '');
        document.getElementById('id-show').innerText = shortId;
        if(role === 'screen') {
            new QRCode(document.getElementById("qrcode"), { text: window.location.href.split('?')[0] + "?join=" + shortId, width: 120, height: 120 });
        } else {
            document.getElementById('gun-input').style.display = 'block';
            document.getElementById('qrcode').style.display = 'none';
            // Silah tarafÄ±nda kamerayÄ± hazÄ±rla
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(s => video.srcObject = s);
        }
    });

    peer.on('connection', (c) => { conn = c; setupConn(); });
}

function connect() {
    conn = peer.connect("DH-" + document.getElementById('target-id').value.toUpperCase(), { reliable: true });
    setupConn();
}

function setupConn() {
    conn.on('open', () => {
        document.getElementById('ui').style.display = 'none';
        if(role === 'screen') {
            document.getElementById('score-board').style.display = 'block';
            initGame();
        } else {
            document.getElementById('fireBtn').style.display = 'block';
        }
    });

    conn.on('data', (data) => {
        if(data === 'SHOT_REQ') window.flashScreen();
        if(data === 'HIT' && role === 'screen') window.registerHit();
    });
}

// OYUN MOTORU (EKRAN)
function initGame() {
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    cvs.style.display = 'block';
    cvs.width = window.innerWidth; cvs.height = window.innerHeight;
    
    let duck = { x: 100, y: 100, dx: 5, dy: 3, r: 40, hit: false };
    let flash = false;

    window.flashScreen = () => { flash = true; setTimeout(() => flash = false, 60); };
    window.registerHit = () => {
        duck.hit = true;
        score += 100;
        document.getElementById('score-board').innerText = "SCORE: " + score;
        setTimeout(() => {
            duck.x = Math.random() * cvs.width;
            duck.y = cvs.height;
            duck.hit = false;
            duck.dx = (5 + score/500) * (Math.random() > 0.5 ? 1 : -1);
            duck.dy = - (5 + score/500);
        }, 1000);
    };

    function draw() {
        ctx.fillStyle = flash ? "white" : "#4ec0ff";
        ctx.fillRect(0, 0, cvs.width, cvs.height);

        if(!flash) {
            if(!duck.hit) {
                duck.x += duck.dx; duck.y += duck.dy;
                if(duck.x < 0 || duck.x > cvs.width) duck.dx *= -1;
                if(duck.y < 0 || duck.y > cvs.height * 0.7) duck.dy *= -1;
                ctx.fillStyle = "yellow";
            } else {
                duck.y += 10; // DÃ¼ÅŸme efekti
                ctx.fillStyle = "red";
            }
            ctx.beginPath(); ctx.arc(duck.x, duck.y, duck.r, 0, 7); ctx.fill();
            // Kanat efekti gibi basit bir kare
            ctx.fillRect(duck.x-10, duck.y-10, 20, 20);
        }
        requestAnimationFrame(draw);
    }
    draw();
}

// SÄ°LAH KONTROLÃœ (TELEFON)
document.getElementById('fireBtn').onclick = () => {
    if(!conn || !conn.open) return;
    conn.send('SHOT_REQ'); // EkranÄ± parlat

    // Parlama anÄ±nda kamerayÄ± analiz et
    setTimeout(() => {
        const tempCvs = document.createElement('canvas');
        tempCvs.width = video.videoWidth;
        tempCvs.height = video.videoHeight;
        const tCtx = tempCvs.getContext('2d');
        tCtx.drawImage(video, 0, 0);
        
        const pixels = tCtx.getImageData(0,0, tempCvs.width, tempCvs.height).data;
        let bright = 0;
        for(let i=0; i<pixels.length; i+=20) { // Performans iÃ§in her piksele bakma
            if(pixels[i] > 220 && pixels[i+1] > 220 && pixels[i+2] > 220) bright++;
        }

        if(bright > 30) { // EÄŸer yeterince beyazlÄ±k gÃ¶rdÃ¼yse
            conn.send('HIT');
            if(navigator.vibrate) navigator.vibrate(200);
        }
    }, 30);
};
</script>
</body>
</html>

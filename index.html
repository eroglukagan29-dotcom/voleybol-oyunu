<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Duck Hunt: QR Connect</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --neon: #39ff14; --retro-blue: #4ec0ff; }
        body { margin: 0; background: #111; color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #menu { background: #222; padding: 30px; border-radius: 20px; border: 4px solid var(--neon); text-align: center; z-index: 100; box-shadow: 0 0 20px rgba(57, 255, 20, 0.3); }
        button { background: var(--neon); border: none; padding: 15px 30px; font-weight: bold; border-radius: 10px; cursor: pointer; margin: 10px; font-size: 1.1rem; transition: 0.2s; }
        button:hover { transform: scale(1.05); filter: brightness(1.1); }
        input { background: #333; border: 2px solid var(--neon); color: white; padding: 10px; border-radius: 8px; text-align: center; font-size: 1.2rem; width: 150px; }
        #qrcode { background: white; padding: 10px; display: inline-block; margin-top: 15px; border-radius: 10px; }
        canvas { position: fixed; top: 0; left: 0; display: none; background: var(--retro-blue); }
        #fireBtn { display: none; position: fixed; bottom: 40px; width: 150px; height: 150px; border-radius: 50%; background: #ff4444; border: 8px solid white; color: white; font-weight: bold; font-size: 1.5rem; box-shadow: 0 10px 0 #cc0000; }
        #fireBtn:active { transform: translateY(5px); box-shadow: 0 5px 0 #cc0000; }
        .info { margin: 10px 0; color: #aaa; }
    </style>
</head>
<body>

<div id="menu">
    <h1>DUCK HUNT</h1>
    <div id="role-select">
        <button onclick="startAs('screen')">ðŸ“º EKRAN OL</button><br>
        <button onclick="startAs('gun')">ðŸ”« SÄ°LAH OL</button>
    </div>

    <div id="screen-setup" style="display:none">
        <p class="info">Telefondan bu kodu girin veya QR'Ä± taratÄ±n:</p>
        <h2 id="my-id" style="color:var(--neon); font-size: 2.5rem; letter-spacing: 5px;">...</h2>
        <div id="qrcode"></div>
    </div>

    <div id="gun-setup" style="display:none">
        <p class="info">Ekrandaki kodu yazÄ±n:</p>
        <input type="text" id="join-id" maxlength="6" placeholder="KOD">
        <button onclick="connectToScreen()">BAÄžLAN</button>
        <p>veya kamerayÄ± aÃ§Ä±p QR taratÄ±n (opsiyonel)</p>
    </div>
</div>

<canvas id="game"></canvas>
<button id="fireBtn">ATEÅž!</button>

<script>
let peer, conn, role;
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const fireBtn = document.getElementById('fireBtn');

// PeerJS BaÅŸlatma (Rastgele 4-5 haneli kÄ±sa ID)
function initPeer(idPrefix) {
    const shortId = Math.random().toString(36).substr(2, 4).toUpperCase();
    peer = new Peer(idPrefix + "-" + shortId);
    
    peer.on('open', (id) => {
        const displayId = id.split('-')[1];
        if(role === 'screen') {
            document.getElementById('my-id').innerText = displayId;
            new QRCode(document.getElementById("qrcode"), {
                text: window.location.href.split('?')[0] + "?join=" + id,
                width: 128, height: 128
            });
        }
    });

    peer.on('connection', (c) => {
        conn = c;
        setupGame();
    });
}

function startAs(r) {
    role = r;
    document.getElementById('role-select').style.display = 'none';
    
    if(role === 'screen') {
        document.getElementById('screen-setup').style.display = 'block';
        initPeer('DUCK');
    } else {
        document.getElementById('gun-setup').style.display = 'block';
        initPeer('GUN');
    }
}

// URL'den QR ile otomatik baÄŸlanma kontrolÃ¼
const urlParams = new URLSearchParams(window.location.search);
if(urlParams.has('join')) {
    startAs('gun');
    setTimeout(() => {
        document.getElementById('join-id').value = urlParams.get('join').split('-')[1];
        connectToScreen();
    }, 1000);
}

function connectToScreen() {
    const targetId = "DUCK-" + document.getElementById('join-id').value.toUpperCase();
    conn = peer.connect(targetId);
    conn.on('open', setupGame);
}

function setupGame() {
    document.getElementById('menu').style.display = 'none';
    if(role === 'screen') {
        canvas.style.display = 'block';
        resize();
        gameLoop();
    } else {
        fireBtn.style.display = 'block';
        fireBtn.onclick = () => conn.send('BANG');
    }
}

// OYUN MOTORU
let duck = { x: 50, y: 50, dx: 4, dy: 3 };
let flash = false;

function gameLoop() {
    ctx.fillStyle = flash ? "white" : "#4ec0ff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if(!flash) {
        duck.x += duck.dx;
        duck.y += duck.dy;
        if(duck.x < 0 || duck.x > canvas.width) duck.dx *= -1;
        if(duck.y < 0 || duck.y > canvas.height * 0.7) duck.dy *= -1;

        ctx.fillStyle = "yellow";
        ctx.beginPath();
        ctx.arc(duck.x, duck.y, 40, 0, Math.PI*2);
        ctx.fill();
    }
    requestAnimationFrame(gameLoop);
}

// Mesaj AlÄ±ndÄ±ÄŸÄ±nda (Ekran TarafÄ±)
peer.on('connection', (c) => {
    c.on('data', (data) => {
        if(data === 'BANG') {
            flash = true;
            setTimeout(() => flash = false, 50);
        }
    });
});

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
</script>
</body>
</html>
